# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none

pool:
   name: UITestPoolAzure

jobs:
  - job: Test
    timeoutInMinutes: 180
    steps:
      - task: AzureCLI@2
        inputs:
          azureSubscription: 'WR-VS'
          scriptType: 'ps'
          scriptLocation: 'inlineScript'
          inlineScript: |
            $script = @"
            Start-ScheduledTask -TaskName "Run Tests"
            do{
                $state = Get-ScheduledTask -TaskName "Run Tests"|select -expand State
                Start-Sleep -Milliseconds 500
            } while($state -eq "Running")
            "@

            Out-File -FilePath .\script.ps1 -InputObject $script

            az vm run-command create --resource-group "test-resource-group" --script "@.\script.ps1" --timeout-in-seconds 600 --run-command-name "myRunCommand" --vm-name "par-test-1" --run-as-password "Ts0rg123_Ts0rg123" --run-as-user "testuser"
